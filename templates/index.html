pip install -r requirements.txt<!doctype html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OCR 前端</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
      :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --bg: #f8fafc;
        --card: #ffffff;
        --accent: #6366f1;
        --accent-hover: #4f46e5;
        --muted: #64748b;
        --border: #e2e8f0;
        --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        --success: #10b981;
        --error: #ef4444;
        --warning: #f59e0b;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: var(--bg);
        background-image: 
          radial-gradient(circle at 20% 80%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 80% 20%, rgba(236, 72, 153, 0.1) 0%, transparent 50%);
        color: #1e293b;
        margin: 0;
        padding: 20px;
        min-height: 100vh;
        line-height: 1.6;
        font-weight: 400;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
      }

      .hero-section {
        text-align: center;
        margin-bottom: 40px;
        animation: fadeInDown 0.8s ease-out;
      }

      .hero-title {
        font-size: clamp(2.5rem, 5vw, 4rem);
        font-weight: 700;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0 0 16px 0;
        letter-spacing: -0.02em;
      }

      .hero-subtitle {
        font-size: 1.25rem;
        color: var(--muted);
        font-weight: 400;
        max-width: 600px;
        margin: 0 auto;
        line-height: 1.8;
      }

      .card {
        background: var(--card);
        border-radius: 20px;
        box-shadow: var(--shadow);
        padding: 32px;
        margin-bottom: 24px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        animation: fadeInUp 0.8s ease-out;
      }

      .card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0 0 8px 0;
        color: #1e293b;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .section-title i {
        color: var(--accent);
        font-size: 1.2rem;
      }

      .upload-section {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
        border: 2px solid var(--border);
        position: relative;
        overflow: hidden;
      }

      .upload-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
      }

      .form-group {
        margin-bottom: 20px;
      }

      .file-input-wrapper {
        position: relative;
        display: inline-block;
        cursor: pointer;
        width: 100%;
      }

      input[type="file"] {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
      }

      .file-input-label {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        padding: 20px;
        border: 2px dashed var(--border);
        border-radius: 12px;
        background: var(--card);
        transition: all 0.3s ease;
        cursor: pointer;
        font-weight: 500;
        color: var(--muted);
      }

      .file-input-label:hover {
        border-color: var(--accent);
        background: #f8faff;
        color: var(--accent);
        transform: scale(1.02);
      }

      .file-input-label.has-file {
        border-color: var(--success);
        background: #f0fdf4;
        color: var(--success);
      }

      input[type="text"] {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid var(--border);
        border-radius: 12px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: var(--card);
        font-family: inherit;
      }

      input[type="text"]:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        transform: translateY(-1px);
      }

      input[type="text"]::placeholder {
        color: #94a3b8;
      }

      .button-group {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      button {
        background: var(--primary-gradient);
        color: white;
        padding: 14px 28px;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      button::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }

      button:hover::before {
        width: 300px;
        height: 300px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
      }

      button:active {
        transform: translateY(0);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .secondary-btn {
        background: var(--card);
        color: var(--muted);
        border: 2px solid var(--border);
      }

      .secondary-btn:hover {
        background: var(--bg);
        border-color: var(--accent);
        color: var(--accent);
      }

      .results-grid {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 24px;
        margin-top: 24px;
      }

      .result-card, .debug-card {
        background: var(--card);
        border-radius: 16px;
        box-shadow: var(--shadow);
        overflow: hidden;
        transition: transform 0.3s ease;
      }

      .result-card:hover, .debug-card:hover {
        transform: translateY(-2px);
      }

      .card-header {
        background: var(--primary-gradient);
        color: white;
        padding: 16px 20px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .result-content {
        padding: 20px;
        min-height: 200px;
        white-space: pre-wrap;
        background: #f8fafc;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        line-height: 1.6;
        border-radius: 0 0 16px 16px;
      }

      .debug-content {
        padding: 20px;
        background: #0f172a;
        color: #e2e8f0;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 13px;
        line-height: 1.5;
        overflow: auto;
        max-height: 400px;
        border-radius: 0 0 16px 16px;
      }

      .preview-section {
        margin-top: 24px;
      }

      .preview-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 12px;
        color: var(--muted);
        font-size: 14px;
        font-weight: 500;
      }

      .preview-image {
        width: 100%;
        max-height: 300px;
        object-fit: contain;
        border-radius: 12px;
        border: 2px solid var(--border);
        background: var(--card);
        padding: 8px;
        box-shadow: var(--shadow);
        transition: transform 0.3s ease;
      }

      .preview-image:hover {
        transform: scale(1.02);
      }

      .status-indicator {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        margin-top: 12px;
      }

      .status-indicator.processing {
        background: #fef3c7;
        color: #92400e;
      }

      .status-indicator.success {
        background: #d1fae5;
        color: #065f46;
      }

      .status-indicator.error {
        background: #fee2e2;
        color: #991b1b;
      }

      .loading-spinner {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }

      .pulse {
        animation: pulse 2s ease-in-out infinite;
      }

      /* 响应式设计 */
      @media (max-width: 1024px) {
        .results-grid {
          grid-template-columns: 1fr;
        }
        
        .debug-content {
          max-height: 300px;
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 12px;
        }
        
        .card {
          padding: 20px;
        }
        
        .hero-title {
          font-size: 2rem;
        }
        
        .hero-subtitle {
          font-size: 1rem;
        }
        
        .button-group {
          flex-direction: column;
        }
        
        button {
          width: 100%;
          justify-content: center;
        }
      }

      @media (max-width: 480px) {
        .container {
          padding: 0;
        }
        
        .card {
          padding: 16px;
          border-radius: 12px;
        }
        
        .upload-section {
          padding: 16px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Hero Section -->
      <div class="hero-section">
        <h1 class="hero-title">
          <i class="fas fa-file-image"></i> OCR 智能识别
        </h1>
        <p class="hero-subtitle">
          上传图片即可快速提取文字内容，支持多种图片格式和自定义识别提示词
        </p>
      </div>

<<<<<<< Updated upstream
    <div class="card">

      <h2 style="margin-top:0">OCR 前端</h2>
      <p class="lead">选择图片并提交，识别结果与原始 JSON 返回将在右侧显示。</p>

    <form id="uploadForm">
      <div>
        <input type="file" id="imageInput" name="image" accept="image/*" multiple required />
      </div>
      <div style="margin-top:8px">
        <input type="text" id="prompt" name="prompt" placeholder="提示词（可选）" style="width:60%" value="{{ default_prompt }}" />
      </div>
      <div style="margin-top:12px">
        <button type="submit">上传并识别</button>
      </div>
    </form>

    <h3>识别结果</h3>
    <div class="grid">
      <div>
        <div id="result" class="result">（等待识别）</div>
        <div style="margin-top:12px" class="muted">已上传图片预览：</div>
        <div id="previewGrid" style="display:grid;grid-template-columns:repeat(auto-fill,120px);gap:8px;margin-top:8px"></div>
=======
      <!-- Upload Section -->
      <div class="card">
        <h2 class="section-title">
          <i class="fas fa-cloud-upload-alt"></i>
          图片上传
        </h2>
        
        <div class="upload-section">
          <form id="uploadForm">
            <div class="form-group">
              <div class="file-input-wrapper">
                <input type="file" id="imageInput" name="image" accept="image/*" required />
                <label for="imageInput" class="file-input-label" id="fileLabel">
                  <i class="fas fa-image fa-2x"></i>
                  <span>点击选择图片或拖拽到此处</span>
                </label>
              </div>
            </div>
            
            <div class="form-group">
              <input type="text" id="prompt" name="prompt" placeholder="请输入识别提示词（可选）" value="{{ default_prompt }}" />
            </div>
            
            <div class="button-group">
              <button type="submit">
                <i class="fas fa-magic"></i>
                开始识别
              </button>
              <button type="button" class="secondary-btn" id="clearBtn">
                <i class="fas fa-times"></i>
                清除
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Results Section -->
      <div class="card">
        <h2 class="section-title">
          <i class="fas fa-chart-line"></i>
          识别结果
        </h2>
        
        <div id="statusIndicator" class="status-indicator processing" style="display: none;">
          <div class="loading-spinner"></div>
          <span>正在处理中...</span>
        </div>
        
        <div class="results-grid">
          <div class="result-card">
            <div class="card-header">
              <i class="fas fa-file-alt"></i>
              识别文本
            </div>
            <div id="result" class="result-content">
              （等待识别...）
            </div>
          </div>
          
          <div class="debug-card">
            <div class="card-header">
              <i class="fas fa-code"></i>
              调试信息
            </div>
            <pre id="rawJson" class="debug-content">(等待请求...)</pre>
          </div>
        </div>

        <!-- Preview Section -->
        <div class="preview-section">
          <div class="preview-header">
            <i class="fas fa-eye"></i>
            图片预览
          </div>
          <img id="previewImg" class="preview-image" src="" alt="预览" style="display: none;" />
        </div>
>>>>>>> Stashed changes
      </div>
    </div>

    <script>
      const form = document.getElementById('uploadForm');
      const resultEl = document.getElementById('result');
      const previewGrid = document.getElementById('previewGrid');
      const rawJsonEl = document.getElementById('rawJson');
<<<<<<< Updated upstream

      // 图片选择后显示多个预览
=======
>>>>>>> Stashed changes
      const fileInputEl = document.getElementById('imageInput');
      const fileLabel = document.getElementById('fileLabel');
      const clearBtn = document.getElementById('clearBtn');
      const statusIndicator = document.getElementById('statusIndicator');

      // 文件选择处理
      fileInputEl.addEventListener('change', () => {
<<<<<<< Updated upstream
        previewGrid.innerHTML = '';
        const files = Array.from(fileInputEl.files || []);
        files.forEach(file => {
          const wrap = document.createElement('div');
          wrap.style.textAlign = 'center';
          const img = document.createElement('img');
          img.src = URL.createObjectURL(file);
          img.style.width = '120px';
          img.style.height = '90px';
          img.style.objectFit = 'cover';
          img.style.borderRadius = '6px';
          img.style.border = '1px solid #e6eefc';
          const label = document.createElement('div');
          label.style.fontSize = '12px';
          label.style.marginTop = '6px';
          label.className = 'muted';
          label.textContent = file.name;
          wrap.appendChild(img);
          wrap.appendChild(label);
          previewGrid.appendChild(wrap);
        });
=======
        const file = fileInputEl.files[0];
        if (!file) {
          previewImg.src = '';
          previewImg.style.display = 'none';
          fileLabel.classList.remove('has-file');
          fileLabel.innerHTML = '<i class="fas fa-image fa-2x"></i><span>点击选择图片或拖拽到此处</span>';
          return;
        }
        
        // 显示文件名和预览
        previewImg.src = URL.createObjectURL(file);
        previewImg.style.display = 'block';
        fileLabel.classList.add('has-file');
        fileLabel.innerHTML = `<i class="fas fa-check-circle fa-2x"></i><span>已选择: ${file.name}</span>`;
        
        // 添加预览动画
        previewImg.style.opacity = '0';
        setTimeout(() => {
          previewImg.style.transition = 'opacity 0.3s ease';
          previewImg.style.opacity = '1';
        }, 100);
>>>>>>> Stashed changes
      });

      // 清除按钮
      clearBtn.addEventListener('click', () => {
        fileInputEl.value = '';
        previewImg.src = '';
        previewImg.style.display = 'none';
        fileLabel.classList.remove('has-file');
        fileLabel.innerHTML = '<i class="fas fa-image fa-2x"></i><span>点击选择图片或拖拽到此处</span>';
        resultEl.textContent = '（等待识别...）';
        rawJsonEl.textContent = '(等待请求...)';
        statusIndicator.style.display = 'none';
      });

      // 表单提交处理
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (!fileInputEl.files.length) {
          showNotification('请选择一张图片', 'error');
          return;
        }

        const formData = new FormData();
<<<<<<< Updated upstream
        const files = Array.from(fileInput.files || []);
        files.forEach(f => formData.append('image', f));
=======
        formData.append('image', fileInputEl.files[0]);
>>>>>>> Stashed changes
        formData.append('prompt', document.getElementById('prompt').value || '识别图片中的内容');

        // 显示加载状态
        resultEl.textContent = '正在识别中，请稍候...';
        rawJsonEl.textContent = '(等待响应...)';
<<<<<<< Updated upstream

        try {
            const start = performance.now();
            const resp = await fetch('/api/ocr', { method: 'POST', body: formData });
            let text = await resp.text();
            let parsed = null;
            try { parsed = JSON.parse(text); } catch(e) { parsed = null; }

            rawJsonEl.textContent = parsed ? JSON.stringify(parsed, null, 2) : text;

            if (resp.ok) {
              // 处理批量返回
              if (parsed && parsed.results && Array.isArray(parsed.results)) {
                resultEl.innerHTML = '';
                parsed.results.forEach(r => {
                  const block = document.createElement('div');
                  block.style.padding = '8px';
                  block.style.borderBottom = '1px solid #eef2ff';
                  const name = document.createElement('div');
                  name.style.fontWeight = '600';
                  name.textContent = r.filename || '(unknown)';
                  const textEl = document.createElement('div');
                  textEl.style.marginTop = '6px';
                  textEl.textContent = r.result || (r.error || '(无识别结果)');
                  const meta = document.createElement('div');
                  meta.className = 'muted';
                  meta.style.marginTop = '6px';
                  meta.textContent = r.elapsed_ms ? ('耗时: ' + r.elapsed_ms + ' ms') : '';
                  block.appendChild(name);
                  block.appendChild(textEl);
                  block.appendChild(meta);
                  resultEl.appendChild(block);
                });
              } else if (parsed && parsed.result) {
                resultEl.textContent = parsed.result;
              } else {
                resultEl.textContent = '(无识别结果)';
              }
            } else {
              resultEl.textContent = '识别失败: ' + (parsed?.error || resp.statusText || text);
            }

        } catch (err) {
          rawJsonEl.textContent = '' + err;
          resultEl.textContent = '请求出错: ' + err.message;
=======
        statusIndicator.style.display = 'flex';
        statusIndicator.className = 'status-indicator processing';
        statusIndicator.innerHTML = '<div class="loading-spinner"></div><span>正在处理中...</span>';
        
        previewImg.style.opacity = '0.7';

        try {
          const start = performance.now();
          const resp = await fetch('/api/ocr', { method: 'POST', body: formData });
          const elapsed = Math.round(performance.now() - start);
          let text = await resp.text();
          let parsed = null;
          
          try { 
            parsed = JSON.parse(text); 
          } catch(e) { 
            parsed = null; 
          }

          // 显示调试信息
          rawJsonEl.textContent = parsed ? JSON.stringify(parsed, null, 2) : text;

          if (resp.ok) {
            statusIndicator.className = 'status-indicator success';
            statusIndicator.innerHTML = `<i class="fas fa-check-circle"></i><span>识别完成 (${elapsed}ms)</span>`;
            
            if (parsed && parsed.result) {
              resultEl.textContent = parsed.result;
              // 添加成功动画
              resultEl.style.animation = 'fadeInUp 0.5s ease-out';
            } else {
              resultEl.textContent = '(无识别结果)';
            }
          } else {
            statusIndicator.className = 'status-indicator error';
            statusIndicator.innerHTML = '<i class="fas fa-exclamation-circle"></i><span>识别失败</span>';
            resultEl.textContent = '识别失败: ' + (parsed?.error || resp.statusText || text);
          }

          previewImg.style.opacity = '1';

        } catch (err) {
          statusIndicator.className = 'status-indicator error';
          statusIndicator.innerHTML = '<i class="fas fa-exclamation-circle"></i><span>请求出错</span>';
          rawJsonEl.textContent = '' + err;
          resultEl.textContent = '请求出错: ' + err.message;
          previewImg.style.opacity = '1';
        }
      });

      // 通知函数
      function showNotification(message, type = 'info') {
        // 创建通知元素
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          padding: 16px 20px;
          border-radius: 12px;
          color: white;
          font-weight: 500;
          z-index: 1000;
          animation: slideInRight 0.3s ease-out;
          box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
        `;
        
        const colors = {
          error: 'linear-gradient(135deg, #ef4444, #dc2626)',
          success: 'linear-gradient(135deg, #10b981, #059669)',
          info: 'linear-gradient(135deg, #6366f1, #4f46e5)'
        };
        
        notification.style.background = colors[type] || colors.info;
        notification.innerHTML = `<i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i> ${message}`;
        
        document.body.appendChild(notification);
        
        // 3秒后自动移除
        setTimeout(() => {
          notification.style.animation = 'fadeOut 0.3s ease-out';
          setTimeout(() => notification.remove(), 300);
        }, 3000);
      }

      // 添加必要的动画样式
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideInRight {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOut {
          from { opacity: 1; }
          to { opacity: 0; }
        }
      `;
      document.head.appendChild(style);

      // 拖拽上传支持
      const uploadSection = document.querySelector('.upload-section');
      
      uploadSection.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadSection.style.borderColor = 'var(--accent)';
        uploadSection.style.background = '#f8faff';
      });
      
      uploadSection.addEventListener('dragleave', (e) => {
        e.preventDefault();
        uploadSection.style.borderColor = 'var(--border)';
        uploadSection.style.background = 'linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)';
      });
      
      uploadSection.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadSection.style.borderColor = 'var(--border)';
        uploadSection.style.background = 'linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)';
        
        const files = e.dataTransfer.files;
        if (files.length > 0 && files[0].type.startsWith('image/')) {
          fileInputEl.files = files;
          const event = new Event('change', { bubbles: true });
          fileInputEl.dispatchEvent(event);
        } else {
          showNotification('请选择有效的图片文件', 'error');
>>>>>>> Stashed changes
        }
      });
    </script>
  </body>
</html>
